

Download
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toply - Recruitment Intelligence Platform</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .tab-active {
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
            color: white;
        }
        .similarity-bar {
            background: linear-gradient(90deg, #10b981, #3b82f6, #8b5cf6);
        }
        .loading-spinner {
            border: 3px solid #e2e8f0;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }
        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }
        .progress-bar {
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #3b82f6);
            transition: width 0.3s ease;
        }
    
        .sync-btn {
            transition: all 0.2s ease;
            border-radius: 6px;
            border: 1px solid transparent;
        }
        .sync-btn:hover {
            background-color: #f3f4f6;
            border-color: #d1d5db;
        }
        .sync-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .sync-btn i.fa-spin {
            animation: spin 1s linear infinite;
        }

        /* Enhanced notification styles for sync */
        .notification.sync-success {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        .notification.sync-error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }

        /* Sync status indicators */
        .sync-indicator {
            position: relative;
        }
        .sync-indicator::before {
            content: '';
            position: absolute;
            top: -2px;
            right: -2px;
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            border: 2px solid white;
        }
        .sync-indicator.syncing::before {
            background: #f59e0b;
            animation: pulse 1s infinite;
        }
        .sync-indicator.error::before {
            background: #ef4444;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
</style>
</head>
<body class="bg-gray-50 font-sans">
    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <div class="flex-shrink-0">
                        <h1 class="text-2xl font-bold bg-gradient-to-r from-blue-600 to-purple-600 bg-clip-text text-transparent">
                            <i class="fas fa-brain mr-2"></i>Toply Intelligence Hub
                        </h1>
                        <p class="text-sm text-gray-500">Advanced Recruitment Intelligence Platform</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <select id="userSelect" class="border border-gray-300 rounded-lg px-3 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">👤 Continue as Guest</option>
                        <option value="Dana">Dana</option>
                        <option value="Alexey">Alexey</option>
                        <option value="Katinka">Katinka</option>
                        <option value="Shiri">Shiri</option>
                        <option value="Mika">Mika</option>
                        <option value="Chen">Chen</option>
                        <option value="Andrea">Andrea</option>
                        <option value="Eszter">Eszter</option>
                        <option value="Danana">Danana</option>
                    </select>
                    <button id="selectedCandidatesBtn" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium transition-colors">
                        <i class="fas fa-list mr-2"></i>Selected (<span id="selectedCount">0</span>)
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation -->
    <nav class="bg-white shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex space-x-8">
                <button class="tab-btn tab-active px-4 py-3 text-sm font-medium rounded-t-lg" data-tab="dashboard">
                    <i class="fas fa-tachometer-alt mr-2"></i>Dashboard
                </button>
                <button class="tab-btn px-4 py-3 text-sm font-medium text-gray-500 hover:text-gray-700" data-tab="search">
                    <i class="fas fa-search mr-2"></i>Smart Search
                </button>
                <button class="tab-btn px-4 py-3 text-sm font-medium text-gray-500 hover:text-gray-700" data-tab="similarity">
                    <i class="fas fa-brain mr-2"></i>AI Similarity
                </button>
                <button class="tab-btn px-4 py-3 text-sm font-medium text-gray-500 hover:text-gray-700" data-tab="sourcing">
                    <i class="fas fa-magic mr-2"></i>Auto-Sourcing
                </button>
                <button class="tab-btn px-4 py-3 text-sm font-medium text-gray-500 hover:text-gray-700" data-tab="companies">
                    <i class="fas fa-building mr-2"></i>Companies
                </button>
                <button class="tab-btn px-4 py-3 text-sm font-medium text-gray-500 hover:text-gray-700" data-tab="settings">
                    <i class="fas fa-cog mr-2"></i>Settings
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content">
            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-xl p-6 card-shadow cursor-pointer hover:shadow-lg transition-shadow" id="hotCompaniesCard">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-red-100">
                            <i class="fas fa-fire text-red-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-500">Hot Companies</p>
                            <p class="text-2xl font-bold text-gray-900" id="hotCompaniesCount">Loading...</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl p-6 card-shadow cursor-pointer hover:shadow-lg transition-shadow" id="activeCandidatesCard">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-green-100">
                            <i class="fas fa-users text-green-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-500">Active Candidates</p>
                            <p class="text-2xl font-bold text-gray-900">100+</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl p-6 card-shadow cursor-pointer hover:shadow-lg transition-shadow" id="topProfilesCard">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-purple-100">
                            <i class="fas fa-star text-purple-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-500">TOP Profiles</p>
                            <p class="text-2xl font-bold text-gray-900" id="topProfilesCount">0</p>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl p-6 card-shadow cursor-pointer hover:shadow-lg transition-shadow" id="goodProfilesCard">
                    <div class="flex items-center">
                        <div class="p-3 rounded-full bg-blue-100">
                            <i class="fas fa-thumbs-up text-blue-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-500">GOOD Profiles</p>
                            <p class="text-2xl font-bold text-gray-900" id="goodProfilesCount">0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Priority Recommendations -->
            <div class="bg-white rounded-xl p-6 card-shadow mb-8">
                <h2 class="text-xl font-bold text-gray-900 mb-4">
                    <i class="fas fa-bullseye text-blue-600 mr-2"></i>Today's Priority Recommendations
                </h2>
                <div class="space-y-4">
                    <div class="flex items-start p-4 bg-red-50 rounded-lg border-l-4 border-red-400">
                        <i class="fas fa-exclamation-circle text-red-500 mt-1 mr-3"></i>
                        <div>
                            <p class="font-semibold text-red-800">Contact candidates from Microsoft immediately</p>
                            <p class="text-red-600 text-sm">3 active candidates + recent layoffs = 85% response rate expected</p>
                        </div>
                    </div>
                    <div class="flex items-start p-4 bg-orange-50 rounded-lg border-l-4 border-orange-400">
                        <i class="fas fa-trending-up text-orange-500 mt-1 mr-3"></i>
                        <div>
                            <p class="font-semibold text-orange-800">Unity talent surge detected</p>
                            <p class="text-orange-600 text-sm">3 candidates from Unity - consider Gaming/Mobile opportunities</p>
                        </div>
                    </div>
                    <div class="flex items-start p-4 bg-blue-50 rounded-lg border-l-4 border-blue-400">
                        <i class="fas fa-shield-alt text-blue-500 mt-1 mr-3"></i>
                        <div>
                            <p class="font-semibold text-blue-800">Security sector opportunity</p>
                            <p class="text-blue-600 text-sm">Review 12 new Security professionals this week</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Market Intelligence -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="bg-white rounded-xl p-6 card-shadow">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">
                        <i class="fas fa-chart-line text-green-600 mr-2"></i>This Week's Intelligence
                    </h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Security sector:</span>
                            <span class="font-semibold text-green-600">23% more active candidates</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Backend roles:</span>
                            <span class="font-semibold text-blue-600">High demand detected</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Microsoft candidates:</span>
                            <span class="font-semibold text-red-600">85% response rate</span>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-xl p-6 card-shadow">
                    <h3 class="text-lg font-bold text-gray-900 mb-4">
                        <i class="fas fa-clock text-purple-600 mr-2"></i>Best Timing Recommendations
                    </h3>
                    <div class="space-y-3">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Wiz candidates:</span>
                            <span class="font-semibold text-green-600">Contact now (layoffs detected)</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Microsoft window:</span>
                            <span class="font-semibold text-orange-600">Next 2 weeks optimal</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">Q1 hiring surge:</span>
                            <span class="font-semibold text-blue-600">Prepare candidate pipeline</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Smart Search Tab -->
        <div id="search" class="tab-content hidden">
            <div class="bg-white rounded-xl p-6 card-shadow mb-8">
                <h2 class="text-xl font-bold text-gray-900 mb-6">
                    <i class="fas fa-search text-blue-600 mr-2"></i>Smart Candidate Search
                </h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Job Title / Role</label>
                        <input type="text" id="jobTitle" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., Backend Engineer">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Skills</label>
                        <input type="text" id="skills" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder='Use "," for AND, "OR" for either'>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Experience Level</label>
                        <select id="experience" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            <option value="">Any</option>
                            <option value="junior">Junior (1-3 years)</option>
                            <option value="mid">Mid-level (3-5 years)</option>
                            <option value="senior">Senior (5+ years)</option>
                            <option value="lead">Lead/Principal (8+ years)</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Location</label>
                        <input type="text" id="location" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="e.g., Tel Aviv, Remote">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Company Filter</label>
                        <input type="text" id="companyFilter" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Company name">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Score Range</label>
                        <input type="range" id="scoreRange" min="0" max="100" value="50" class="w-full">
                        <span class="text-sm text-gray-500">Minimum: <span id="scoreValue">50</span></span>
                    </div>
                </div>

                <div class="flex flex-wrap items-center gap-4 mb-6">
                    <label class="flex items-center">
                        <input type="checkbox" id="onlyLooking" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                        <span class="ml-2 text-sm text-gray-700">Show only LOOKING candidates</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" id="onlyHotCompanies" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                        <span class="ml-2 text-sm text-gray-700">Show only from Hot Companies</span>
                    </label>
                    <label class="flex items-center">
                        <input type="checkbox" id="onlyUnviewed" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500">
                        <span class="ml-2 text-sm text-gray-700">Show only unviewed (this week)</span>
                    </label>
                </div>

                <button id="searchBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg font-medium transition-colors">
                    <i class="fas fa-search mr-2"></i>Search Candidates
                </button>
            </div>

            <!-- Search Results -->
            <div id="searchResults" class="bg-white rounded-xl p-6 card-shadow">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-bold text-gray-900">Search Results</h3>
                    <div class="flex space-x-2">
                        <button id="exportSelected" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                            <i class="fas fa-download mr-2"></i>Export CSV
                        </button>
                        <button id="exportLinkedIn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium">
                            <i class="fab fa-linkedin mr-2"></i>Export LinkedIn URLs
                        </button>
                    </div>
                </div>
                <div id="candidatesList">
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-search text-4xl mb-4"></i>
                        <p>Use the search filters above to find candidates</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- AI Similarity Tab -->
        <div id="similarity" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Upload Scorely Results -->
                <div class="bg-white rounded-xl p-6 card-shadow">
                    <h2 class="text-xl font-bold text-gray-900 mb-6">
                        <i class="fas fa-upload text-purple-600 mr-2"></i>Upload Scorely Results
                    </h2>
                    
                    <div id="uploadArea" class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-blue-500 transition-colors cursor-pointer">
                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                        <p class="text-gray-600 mb-2">Drag & drop Scorely JSON file here</p>
                        <p class="text-sm text-gray-500 mb-4">or click to browse</p>
                        <p class="text-xs text-gray-400">Supports: .json, .csv files with embeddings</p>
                        <input type="file" id="scorelyFile" accept=".json,.csv" class="hidden">
                    </div>
                    
                    <div id="uploadStatus" class="mt-4 hidden">
                        <div class="flex items-center text-green-600">
                            <i class="fas fa-check-circle mr-2"></i>
                            <span>File uploaded successfully</span>
                        </div>
                    </div>
                </div>

                <!-- Find Similar Candidates -->
                <div class="bg-white rounded-xl p-6 card-shadow">
                    <h2 class="text-xl font-bold text-gray-900 mb-6">
                        <i class="fas fa-brain text-blue-600 mr-2"></i>Find Similar Candidates
                    </h2>
                    
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Job Description or Candidate Profile</label>
                        <textarea id="similarityInput" rows="4" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Paste job description or describe the ideal candidate profile..."></textarea>
                    </div>
                    
                    <button id="findSimilarBtn" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg font-medium transition-colors w-full">
                        <i class="fas fa-magic mr-2"></i>Find Similar Candidates
                    </button>
                </div>
            </div>

            <!-- Similarity Results -->
            <div id="similarityResults" class="bg-white rounded-xl p-6 card-shadow mt-8 hidden">
                <h3 class="text-lg font-bold text-gray-900 mb-4">
                    <i class="fas fa-chart-bar text-green-600 mr-2"></i>Similarity Results
                </h3>
                <div id="similarityList"></div>
            </div>
        </div>

        <!-- Auto-Sourcing Tab -->
        <div id="sourcing" class="tab-content hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <!-- Success Patterns Analysis -->
                <div class="bg-white rounded-xl p-6 card-shadow">
                    <h2 class="text-xl font-bold text-gray-900 mb-6">
                        <i class="fas fa-chart-line text-green-600 mr-2"></i>Success Patterns Analysis
                    </h2>
                    
                    <div class="space-y-6">
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-3">Top Companies</h4>
                            <div class="space-y-2">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Wiz</span>
                                    <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm">3 TOP</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Cybereason</span>
                                    <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm">2 TOP</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Astrix</span>
                                    <span class="bg-green-100 text-green-800 px-2 py-1 rounded text-sm">2 TOP</span>
                                </div>
                            </div>
                        </div>

                        <div>
                            <h4 class="font-semibold text-gray-800 mb-3">Top Skills</h4>
                            <div class="space-y-2">
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Python</span>
                                    <span class="text-blue-600 font-semibold">85%</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">AWS</span>
                                    <span class="text-blue-600 font-semibold">78%</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-gray-600">Kubernetes</span>
                                    <span class="text-blue-600 font-semibold">71%</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Generated Boolean Queries -->
                <div class="bg-white rounded-xl p-6 card-shadow">
                    <h2 class="text-xl font-bold text-gray-900 mb-6">
                        <i class="fas fa-code text-purple-600 mr-2"></i>Generated Boolean Queries
                    </h2>
                    
                    <div class="space-y-4">
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">LinkedIn Boolean Query</h4>
                            <div class="bg-gray-50 p-3 rounded-lg text-sm font-mono">
                                ("Backend Engineer" OR "Senior Developer") ("Python" OR "AWS" OR "Kubernetes") ("Wiz" OR "Cybereason" OR "Astrix")
                            </div>
                            <div class="flex space-x-2 mt-2">
                                <button id="copyLinkedInQuery" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">
                                    <i class="fas fa-copy mr-1"></i>Copy
                                </button>
                                <button id="openLinkedIn" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded text-sm">
                                    <i class="fab fa-linkedin mr-1"></i>Open in LinkedIn
                                </button>
                            </div>
                        </div>

                        <div>
                            <h4 class="font-semibold text-gray-800 mb-2">Google Boolean Query</h4>
                            <div class="bg-gray-50 p-3 rounded-lg text-sm font-mono">
                                ("Backend Engineer" OR "Senior Developer") Python AWS site:linkedin.com
                            </div>
                            <div class="flex space-x-2 mt-2">
                                <button id="copyGoogleQuery" class="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm">
                                    <i class="fas fa-copy mr-1"></i>Copy
                                </button>
                                <button id="openGoogle" class="bg-red-500 hover:bg-red-600 text-white px-3 py-1 rounded text-sm">
                                    <i class="fab fa-google mr-1"></i>Open in Google
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Smart Sourcing Suggestions -->
            <div class="bg-white rounded-xl p-6 card-shadow">
                <h3 class="text-lg font-bold text-gray-900 mb-4">
                    <i class="fas fa-lightbulb text-yellow-500 mr-2"></i>Smart Sourcing Suggestions
                </h3>
                <div class="space-y-4">
                    <div class="flex items-start p-4 bg-blue-50 rounded-lg">
                        <i class="fas fa-target text-blue-500 mt-1 mr-3"></i>
                        <div>
                            <p class="font-semibold text-blue-800">Try targeting Backend Engineers at Check Point</p>
                            <p class="text-blue-600 text-sm">Similar security company profile to your successful Wiz hires</p>
                        </div>
                    </div>
                    <div class="flex items-start p-4 bg-green-50 rounded-lg">
                        <i class="fas fa-search text-green-500 mt-1 mr-3"></i>
                        <div>
                            <p class="font-semibold text-green-800">Look for Python developers with 5+ years experience</p>
                            <p class="text-green-600 text-sm">82% success rate in your previous TOP-rated candidates</p>
                        </div>
                    </div>
                    <div class="flex items-start p-4 bg-purple-50 rounded-lg">
                        <i class="fas fa-chart-line text-purple-500 mt-1 mr-3"></i>
                        <div>
                            <p class="font-semibold text-purple-800">Consider DevOps from Security companies</p>
                            <p class="text-purple-600 text-sm">80% skill overlap with your successful Backend Engineer hires</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Companies Tab -->
        <div id="companies" class="tab-content hidden">
            <div class="bg-white rounded-xl p-6 card-shadow">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-xl font-bold text-gray-900">
                        <i class="fas fa-fire text-red-600 mr-2"></i>Hot Companies This Week
                    </h2>
                    <div class="flex space-x-2">
                        <select id="industryFilter" class="border border-gray-300 rounded-lg px-3 py-2 text-sm">
                            <option value="">All Industries</option>
                            <option value="Security">Security</option>
                            <option value="Fintech">Fintech</option>
                            <option value="Big Tech">Big Tech</option>
                            <option value="SAAS">SAAS</option>
                        </select>
                        <select id="eventTypeFilter" class="border border-gray-300 rounded-lg px-3 py-2 text-sm">
                            <option value="">All Events</option>
                            <option value="Layoffs">Layoffs</option>
                            <option value="Closure">Closure</option>
                            <option value="Executive Departures">Executive Departures</option>
                            <option value="Negative reviews">Negative reviews</option>
                        </select>
                    </div>
                </div>
                
                <p class="text-gray-600 mb-6">Companies with recent activity - higher candidate response rates expected</p>
                
                <div id="hotCompaniesList">
                    <div class="flex items-center justify-center py-8">
                        <div class="loading-spinner mr-3"></div>
                        <span class="text-gray-500">Loading hot companies data...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content hidden">
            <div class="space-y-8">
                <!-- API Configuration -->
                <div class="bg-white rounded-xl p-6 card-shadow">
                    <h2 class="text-xl font-bold text-gray-900 mb-6">
                        <i class="fas fa-cog text-gray-600 mr-2"></i>Settings & Integrations
                    </h2>
                    
                    <!-- Google Sheets Integration -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Google Sheets Integration</h3>
                        <div class="flex space-x-4">
                            <div class="flex-1">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Google Sheets API Key</label>
                                <input type="password" id="googleApiKey" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter your Google Sheets API key">
                            </div>
                            <div class="flex items-end">
                                <button id="testGoogleConnection" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium">
                                    <i class="fas fa-check mr-2"></i>Test Connection
                                </button>
                            </div>
                        </div>
                        <div id="googleConnectionStatus" class="mt-2"></div>
                    </div>

                    <!-- OpenAI Integration -->
                    <div class="mb-8">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">OpenAI Integration</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">OpenAI API Key</label>
                                <input type="password" id="openaiApiKey" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Enter your OpenAI API key">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Model Selection</label>
                                <select id="openaiModel" class="w-full border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="text-embedding-3-small">text-embedding-3-small (Recommended)</option>
                                    <option value="text-embedding-3-large">text-embedding-3-large</option>
                                    <option value="text-embedding-ada-002">text-embedding-ada-002</option>
                                </select>
                            </div>
                        </div>
                        <div class="flex justify-between items-center mt-4">
                            <div id="openaiConnectionStatus"></div>
                            <button id="testOpenAIConnection" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-medium">
                                <i class="fas fa-check mr-2"></i>Test Connection
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Data Sources Status -->
                <div class="bg-white rounded-xl p-6 card-shadow">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Data Sources</h3>
                    <div class="space-y-4">
                        <div class="flex justify-between items-center p-4 bg-green-50 rounded-lg">
                            <div>
                                <h4 class="font-semibold text-green-800">Active Candidates</h4>
                                <p class="text-green-600 text-sm">100+ candidates actively looking for opportunities</p>
                            </div>
                            <span class="bg-green-200 text-green-800 px-3 py-1 rounded-full text-sm font-medium">Connected</span>
                        </div>
                        <div class="flex justify-between items-center p-4 bg-red-50 rounded-lg">
                            <div>
                                <h4 class="font-semibold text-red-800">Hot Companies</h4>
                                <p class="text-red-600 text-sm" id="hotCompaniesStatus">Loading companies with recent market events</p>
                            </div>
                            <span class="bg-red-200 text-red-800 px-3 py-1 rounded-full text-sm font-medium" id="hotCompaniesConnectionStatus">Loading...</span>
                        </div>
                        <div class="flex justify-between items-center p-4 bg-blue-50 rounded-lg">
                            <div>
                                <h4 class="font-semibold text-blue-800">Companies Database</h4>
                                <p class="text-blue-600 text-sm">396 companies with detailed intelligence</p>
                            </div>
                            <span class="bg-blue-200 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">Connected</span>
                        </div>
                        <div class="flex justify-between items-center p-4 bg-purple-50 rounded-lg">
                            <div>
                                <h4 class="font-semibold text-purple-800">Scorely Results</h4>
                                <p class="text-purple-600 text-sm">TOP and GOOD candidate profiles with embeddings</p>
                            </div>
                            <span class="bg-purple-200 text-purple-800 px-3 py-1 rounded-full text-sm font-medium">Upload Required</span>
                        </div>
                    </div>
                </div>

                <!-- Setup Instructions -->
                <div class="bg-blue-50 border border-blue-200 rounded-xl p-6">
                    <h3 class="text-lg font-semibold text-blue-800 mb-4">
                        <i class="fas fa-shield-alt mr-2"></i>Secure Setup Instructions
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-semibold text-blue-800 mb-2">For Netlify Deployment:</h4>
                            <ol class="text-sm text-blue-700 space-y-1">
                                <li>1. Go to your Netlify site dashboard</li>
                                <li>2. Navigate to Site Settings → Environment Variables</li>
                                <li>3. Add these variables:</li>
                                <li class="ml-4">• GOOGLE_API_KEY → Your Google Sheets API key</li>
                                <li class="ml-4">• OPENAI_API_KEY → Your OpenAI API key</li>
                                <li>4. Deploy your site - keys will be automatically loaded</li>
                            </ol>
                        </div>
                        <div>
                            <h4 class="font-semibold text-blue-800 mb-2">Security Benefits:</h4>
                            <ul class="text-sm text-blue-700 space-y-1">
                                <li>🔒 API keys never exposed in code</li>
                                <li>🛡️ Safe for public GitHub repositories</li>
                                <li>👥 Team access without sharing keys</li>
                                <li>📝 Easy key rotation and management</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Selected Candidates Sidebar -->
    <div id="selectedSidebar" class="fixed right-0 top-0 h-full w-80 bg-white shadow-xl transform translate-x-full transition-transform duration-300 z-50">
        <div class="p-6 border-b">
            <div class="flex justify-between items-center">
                <h3 class="text-lg font-bold text-gray-900">Selected Candidates</h3>
                <button id="closeSidebar" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="p-6 flex-1 overflow-y-auto">
            <div id="selectedCandidatesList" class="space-y-4">
                <div class="text-center text-gray-500 py-8">
                    <i class="fas fa-users text-4xl mb-4"></i>
                    <p>No candidates selected</p>
                </div>
            </div>
        </div>
        <div class="p-6 border-t">
            <div class="space-y-2">
                <button id="exportSelectedCandidates" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-medium">
                    <i class="fas fa-download mr-2"></i>Export CSV
                </button>
                <button id="exportSelectedLinkedIn" class="w-full bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg font-medium">
                    <i class="fab fa-linkedin mr-2"></i>Export LinkedIn URLs
                </button>
                <button id="clearSelected" class="w-full bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg font-medium">
                    <i class="fas fa-trash mr-2"></i>Clear All
                </button>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div id="notification" class="notification bg-white border border-gray-200 rounded-lg shadow-lg p-4 max-w-sm">
        <div class="flex items-center">
            <div id="notificationIcon" class="mr-3"></div>
            <div>
                <p id="notificationTitle" class="font-semibold text-gray-900"></p>
                <p id="notificationMessage" class="text-sm text-gray-600"></p>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let selectedCandidates = [];
        let hotCompaniesData = [];
        let candidatesData = [];
        let scorelyData = [];
        let currentUser = null;
        let viewedCandidates = {};

        // API Configuration
        const GOOGLE_SHEETS_API_KEY = process?.env?.GOOGLE_API_KEY || localStorage.getItem('googleApiKey') || '';
        const OPENAI_API_KEY = process?.env?.OPENAI_API_KEY || localStorage.getItem('openaiApiKey') || '';
        // Google Sheets Sync Configuration
        const SYNC_SCHEDULE = {
            morningHour: 9,
            afternoonHour: 16,
            intervalCheckMinutes: 1 // Check every minute if it's time to sync
        };

        let syncInterval;
        let lastSyncDate = localStorage.getItem('lastSyncDate') || '';
        let syncCount = 0;

        // Add sync button to header
        function addSyncButton() {
            const headerNav = document.querySelector('nav .flex.space-x-8');
            if (headerNav && !document.getElementById('syncButton')) {
                const syncButton = document.createElement('button');
                syncButton.id = 'syncButton';
                syncButton.className = 'sync-btn px-3 py-2 text-sm font-medium text-gray-600 hover:text-blue-600 transition-colors';
                syncButton.innerHTML = '<i class="fas fa-sync-alt mr-2"></i>Sync Now';
                syncButton.onclick = manualSync;
                headerNav.appendChild(syncButton);
            }
        }

        // Initialize auto-sync schedule
        function initializeAutoSync() {
            // Clear any existing interval
            if (syncInterval) {
                clearInterval(syncInterval);
            }

            // Check every minute if it's time for scheduled sync
            syncInterval = setInterval(checkScheduledSync, SYNC_SCHEDULE.intervalCheckMinutes * 60 * 1000);

            // Also do an initial sync if we haven't synced today
            const today = new Date().toDateString();
            if (lastSyncDate !== today) {
                setTimeout(() => manualSync(true), 2000); // Initial sync after 2 seconds
            }
        }

        function checkScheduledSync() {
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes();
            const today = now.toDateString();

            // Check if we should sync (at 9:00 or 16:00, and we haven't synced today at this time)
            const shouldSyncMorning = currentHour === SYNC_SCHEDULE.morningHour && currentMinute === 0;
            const shouldSyncAfternoon = currentHour === SYNC_SCHEDULE.afternoonHour && currentMinute === 0;

            if ((shouldSyncMorning || shouldSyncAfternoon)) {
                const syncKey = `sync_${today}_${currentHour}`;
                const alreadySynced = localStorage.getItem(syncKey);

                if (!alreadySynced) {
                    console.log(`Auto-sync triggered at ${currentHour}:${currentMinute}`);
                    manualSync(true);
                    localStorage.setItem(syncKey, 'true');
                }
            }
        }

        async function manualSync(isAutoSync = false) {
            const syncButton = document.getElementById('syncButton');
            const originalContent = syncButton?.innerHTML || '';

            try {
                if (syncButton) {
                    syncButton.disabled = true;
                    syncButton.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Syncing...';
                }

                const syncType = isAutoSync ? 'Auto' : 'Manual';
                console.log(`${syncType} sync started...`);

                // Sync hot companies data
                await loadHotCompanies();

                // Update last sync timestamp
                const now = new Date();
                lastSyncDate = now.toDateString();
                localStorage.setItem('lastSyncDate', lastSyncDate);
                localStorage.setItem('lastSyncTime', now.toISOString());

                // Update sync counter
                syncCount++;
                localStorage.setItem('syncCount', syncCount.toString());

                // Update dashboard stats
                updateDashboardStats();

                // Show success notification
                showNotification('success', `${syncType} Sync Complete`, 
                    `Data synchronized successfully at ${now.toLocaleTimeString()}`);

                // Update sync status in settings if visible
                updateSyncStatus();

            } catch (error) {
                console.error('Sync failed:', error);
                showNotification('error', 'Sync Failed', error.message);
            } finally {
                if (syncButton) {
                    syncButton.disabled = false;
                    syncButton.innerHTML = originalContent;
                }
            }
        }

        function updateSyncStatus() {
            const syncStatusEl = document.getElementById('syncStatus');
            if (syncStatusEl) {
                const lastSyncTime = localStorage.getItem('lastSyncTime');
                if (lastSyncTime) {
                    const syncDate = new Date(lastSyncTime);
                    syncStatusEl.innerHTML = `
                        <div class="text-sm text-gray-600">
                            <div>Last sync: ${syncDate.toLocaleString()}</div>
                            <div>Total syncs: ${localStorage.getItem('syncCount') || 0}</div>
                            <div>Next auto-sync: ${getNextSyncTime()}</div>
                        </div>
                    `;
                } else {
                    syncStatusEl.innerHTML = '<div class="text-sm text-gray-500">No sync performed yet</div>';
                }
            }
        }

        function getNextSyncTime() {
            const now = new Date();
            const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());

            // Check for next sync time today
            const morningSync = new Date(today.getTime() + SYNC_SCHEDULE.morningHour * 60 * 60 * 1000);
            const afternoonSync = new Date(today.getTime() + SYNC_SCHEDULE.afternoonHour * 60 * 60 * 1000);

            if (now < morningSync) {
                return morningSync.toLocaleTimeString();
            } else if (now < afternoonSync) {
                return afternoonSync.toLocaleTimeString();
            } else {
                // Next sync is tomorrow morning
                const tomorrow = new Date(today.getTime() + 24 * 60 * 60 * 1000);
                const tomorrowMorning = new Date(tomorrow.getTime() + SYNC_SCHEDULE.morningHour * 60 * 60 * 1000);
                return `Tomorrow ${tomorrowMorning.toLocaleTimeString()}`;
            }
        }

        // Enhanced hot companies detection with better analysis
        async function detectHotCompaniesFromSheets(sheetsData) {
            if (!sheetsData || !sheetsData.values || sheetsData.values.length < 2) {
                return [];
            }

            const headers = sheetsData.values[0];
            const rows = sheetsData.values.slice(1);

            // Look for company-related columns
            const companyIndex = headers.findIndex(h => h.toLowerCase().includes('company'));
            const statusIndex = headers.findIndex(h => h.toLowerCase().includes('status'));
            const scoreIndex = headers.findIndex(h => h.toLowerCase().includes('score'));
            const dateIndex = headers.findIndex(h => h.toLowerCase().includes('date'));

            const companyStats = {};

            rows.forEach(row => {
                if (!row[companyIndex]) return;

                const company = row[companyIndex];
                const status = row[statusIndex] || '';
                const score = parseFloat(row[scoreIndex]) || 0;
                const date = row[dateIndex] || '';

                if (!companyStats[company]) {
                    companyStats[company] = {
                        totalCandidates: 0,
                        activeCandidates: 0,
                        avgScore: 0,
                        scores: [],
                        recentActivity: 0
                    };
                }

                companyStats[company].totalCandidates++;
                if (status.toLowerCase().includes('active') || status.toLowerCase().includes('looking')) {
                    companyStats[company].activeCandidates++;
                }
                if (score > 0) {
                    companyStats[company].scores.push(score);
                }

                // Check for recent activity (last 30 days)
                if (date) {
                    const candidateDate = new Date(date);
                    const thirtyDaysAgo = new Date();
                    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                    if (candidateDate > thirtyDaysAgo) {
                        companyStats[company].recentActivity++;
                    }
                }
            });

            // Calculate average scores and identify hot companies
            const hotCompanies = [];
            Object.entries(companyStats).forEach(([company, stats]) => {
                if (stats.scores.length > 0) {
                    stats.avgScore = stats.scores.reduce((a, b) => a + b, 0) / stats.scores.length;
                }

                // Criteria for "hot" companies:
                // 1. 3+ active candidates, OR
                // 2. 5+ total candidates with avg score > 80, OR
                // 3. 3+ candidates with recent activity
                let eventType = '';
                let reason = '';

                if (stats.activeCandidates >= 3) {
                    eventType = 'EXODUS';
                    reason = `${stats.activeCandidates} active candidates detected`;
                } else if (stats.totalCandidates >= 5 && stats.avgScore > 80) {
                    eventType = 'HIGH_PERFORMERS';
                    reason = `${stats.totalCandidates} high-scoring candidates (avg: ${stats.avgScore.toFixed(1)})`;
                } else if (stats.recentActivity >= 3) {
                    eventType = 'RECENT_ACTIVITY';
                    reason = `${stats.recentActivity} candidates with recent activity`;
                }

                if (eventType) {
                    hotCompanies.push({
                        Company: company,
                        'Event Type': eventType,
                        Industry: 'Technology', // Default, could be enhanced
                        Source: 'Auto-detected',
                        Date: new Date().toISOString().split('T')[0],
                        Reason: reason,
                        'Total Candidates': stats.totalCandidates,
                        'Active Candidates': stats.activeCandidates,
                        'Avg Score': stats.avgScore.toFixed(1)
                    });
                }
            });

            return hotCompanies.sort((a, b) => b['Active Candidates'] - a['Active Candidates']);
        }


        
        // Google Sheets IDs
        const SHEETS_CONFIG = {
            hotCompanies: {
                sheetId: '1It9bHPbIRXX3Ezf_-phAZvyE3SYMbd1zt7PlkrLX-HU',
                gid: '433369677', // Hot signals tab
                range: 'A:I'
            },
            activeCandidates: {
                sheetId: '1QNQDB--R4yRhvI_fe7C2wn9g94WPDqZYRXsGJFrbJQA',
                range: 'A:D'
            },
            companies: {
                sheetId: '1It9bHPbIRXX3Ezf_-phAZvyE3SYMbd1zt7PlkrLX-HU',
                gid: '0', // Companies tab
                range: 'A:Z'
            }
        };

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            setupEventListeners();
            loadInitialData();
        });

        function initializeApp() {
            // Load saved settings
            const savedGoogleKey = localStorage.getItem('googleApiKey');
            const savedOpenAIKey = localStorage.getItem('openaiApiKey');
            
            if (savedGoogleKey) {
                document.getElementById('googleApiKey').value = savedGoogleKey;
            
            // Initialize sync functionality
            addSyncButton();
            initializeAutoSync();
            updateSyncStatus();
            }
            if (savedOpenAIKey) {
                document.getElementById('openaiApiKey').value = savedOpenAIKey;
            }

            // Load user preferences
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                document.getElementById('userSelect').value = savedUser;
                currentUser = savedUser;
            }

            // Load viewed candidates
            const savedViewed = localStorage.getItem('viewedCandidates');
            if (savedViewed) {
                viewedCandidates = JSON.parse(savedViewed);
            }
        }

        function setupEventListeners() {
            // Tab navigation
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const tabName = e.target.dataset.tab;
                    switchTab(tabName);
                });
            });

            // User selection
            document.getElementById('userSelect').addEventListener('change', (e) => {
                currentUser = e.target.value || null;
                localStorage.setItem('currentUser', currentUser || '');
                updateUserStatus();
            });

            // Dashboard cards
            document.getElementById('hotCompaniesCard').addEventListener('click', () => {
                switchTab('companies');
            });

            document.getElementById('activeCandidatesCard').addEventListener('click', () => {
                switchTab('search');
                document.getElementById('onlyLooking').checked = true;
            });

            // Search functionality
            document.getElementById('searchBtn').addEventListener('click', performSearch);
            document.getElementById('scoreRange').addEventListener('input', (e) => {
                document.getElementById('scoreValue').textContent = e.target.value;
            });

            // Similarity search
            document.getElementById('uploadArea').addEventListener('click', () => {
                document.getElementById('scorelyFile').click();
            });

            document.getElementById('scorelyFile').addEventListener('change', handleFileUpload);
            document.getElementById('findSimilarBtn').addEventListener('click', findSimilarCandidates);

            // Auto-sourcing buttons
            document.getElementById('copyLinkedInQuery').addEventListener('click', () => {
                copyToClipboard(generateLinkedInQuery());
            });

            document.getElementById('copyGoogleQuery').addEventListener('click', () => {
                copyToClipboard(generateGoogleQuery());
            });

            document.getElementById('openLinkedIn').addEventListener('click', () => {
                openLinkedInSearch(generateLinkedInQuery());
            });

            document.getElementById('openGoogle').addEventListener('click', () => {
                openGoogleSearch(generateGoogleQuery());
            });

            // Settings
            document.getElementById('testGoogleConnection').addEventListener('click', testGoogleConnection);
            document.getElementById('testOpenAIConnection').addEventListener('click', testOpenAIConnection);

            // API key saving
            document.getElementById('googleApiKey').addEventListener('change', (e) => {
                localStorage.setItem('googleApiKey', e.target.value);
            });

            document.getElementById('openaiApiKey').addEventListener('change', (e) => {
                localStorage.setItem('openaiApiKey', e.target.value);
            });

            // Selected candidates sidebar
            document.getElementById('selectedCandidatesBtn').addEventListener('click', toggleSidebar);
            document.getElementById('closeSidebar').addEventListener('click', closeSidebar);

            // Export buttons
            document.getElementById('exportSelected').addEventListener('click', exportSelectedCandidates);
            document.getElementById('exportLinkedIn').addEventListener('click', exportLinkedInUrls);
            document.getElementById('clearSelected').addEventListener('click', clearSelectedCandidates);
        }

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.add('text-gray-500', 'hover:text-gray-700');
            });

            const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
            if (activeBtn) {
                activeBtn.classList.add('tab-active');
                activeBtn.classList.remove('text-gray-500', 'hover:text-gray-700');
            }

            // Show/hide content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });

            const activeContent = document.getElementById(tabName);
            if (activeContent) {
                activeContent.classList.remove('hidden');
            }
        }

        async function loadInitialData() {
            try {
                await loadHotCompanies();
                await loadActiveCandidates();
                updateDashboardStats();
            } catch (error) {
                console.error('Error loading initial data:', error);
                showNotification('error', 'Data Loading Failed', 'Unable to load some data sources');
            }
        }

        async function loadHotCompanies() {
            try {
                const apiKey = GOOGLE_SHEETS_API_KEY || document.getElementById('googleApiKey').value;
                if (!apiKey) {
                    throw new Error('Google Sheets API key not configured');
                }

                // Use the main candidates sheet for hot companies detection
                const sheetId = '1It9bHPbIRXX3Ezf_-phAZvyE3SYMbd1zt7PlkrLX-HU'; // Your sheet ID
                const range = 'A1:I1000'; // Covers all your data columns
                const timestamp = Date.now(); // Cache busting
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}&timestamp=${timestamp}`;

                const response = await fetch(url, {
                    headers: {
                        'Cache-Control': 'no-cache, no-store, must-revalidate',
                        'Pragma': 'no-cache',
                        'Expires': '0'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                if (data.values && data.values.length > 1) {
                    // Detect hot companies from the sheets data
                    const detectedHotCompanies = await detectHotCompaniesFromSheets(data);

                    // Also update candidates data for other features
                    const headers = data.values[0];
                    candidatesData = data.values.slice(1).filter(row => row[0]).map(row => {
                        const candidate = {};
                        headers.forEach((header, index) => {
                            candidate[header] = row[index] || '';
                        });
                        return candidate;
                    });

                    // Use detected hot companies
                    hotCompaniesData = detectedHotCompanies;

                    document.getElementById('hotCompaniesCount').textContent = hotCompaniesData.length;
                    document.getElementById('hotCompaniesStatus').textContent = `${hotCompaniesData.length} companies with recent activity detected`;
                    document.getElementById('hotCompaniesConnectionStatus').textContent = 'Connected';
                    document.getElementById('hotCompaniesConnectionStatus').className = 'bg-green-200 text-green-800 px-3 py-1 rounded-full text-sm font-medium';

                    displayHotCompanies();
                    showNotification('success', 'Hot Companies Detected', `${hotCompaniesData.length} hot companies found from ${candidatesData.length} candidates`);
                } else {
                    throw new Error('No data found in candidates sheet');
                }
            } catch (error) {
                console.error('Error loading hot companies:', error);
                document.getElementById('hotCompaniesCount').textContent = 'Error';
                document.getElementById('hotCompaniesStatus').textContent = 'Failed to load hot companies data';
                document.getElementById('hotCompaniesConnectionStatus').textContent = 'Failed';
                document.getElementById('hotCompaniesConnectionStatus').className = 'bg-red-200 text-red-800 px-3 py-1 rounded-full text-sm font-medium';

                showNotification('error', 'Hot Companies Failed', error.message);
            }
        }

                const config = SHEETS_CONFIG.hotCompanies;
                const timestamp = Date.now(); // Cache busting
                const url = `https://sheets.googleapis.com/v4/spreadsheets/${config.sheetId}/values/${config.range}?key=${apiKey}&timestamp=${timestamp}`;
                
                const response = await fetch(url, {
                    headers: {
                        'Cache-Control': 'no-cache, no-store, must-revalidate',
                        'Pragma': 'no-cache',
                        'Expires': '0'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                if (data.values && data.values.length > 1) {
                    const headers = data.values[0];
                    hotCompaniesData = data.values.slice(1).filter(row => row[0]).map(row => {
                        const company = {};
                        headers.forEach((header, index) => {
                            company[header] = row[index] || '';
                        });
                        return company;
                    });

                    document.getElementById('hotCompaniesCount').textContent = hotCompaniesData.length;
                    document.getElementById('hotCompaniesStatus').textContent = `${hotCompaniesData.length} companies with recent market events`;
                    document.getElementById('hotCompaniesConnectionStatus').textContent = 'Connected';
                    document.getElementById('hotCompaniesConnectionStatus').className = 'bg-green-200 text-green-800 px-3 py-1 rounded-full text-sm font-medium';

                    displayHotCompanies();
                    showNotification('success', 'Hot Companies Loaded', `${hotCompaniesData.length} companies loaded successfully`);
                } else {
                    throw new Error('No data found in hot companies sheet');
                }
            } catch (error) {
                console.error('Error loading hot companies:', error);
                document.getElementById('hotCompaniesCount').textContent = 'Error';
                document.getElementById('hotCompaniesStatus').textContent = 'Failed to load hot companies data';
                document.getElementById('hotCompaniesConnectionStatus').textContent = 'Failed';
                document.getElementById('hotCompaniesConnectionStatus').className = 'bg-red-200 text-red-800 px-3 py-1 rounded-full text-sm font-medium';
                
                showNotification('error', 'Hot Companies Failed', error.message);
            }
        }

        async function loadActiveCandidates() {
            // Simulate loading active candidates
            candidatesData = generateDemoCandidates();
            showNotification('success', 'Active Candidates Loaded', '100+ candidates ready for search');
        }

        function displayHotCompanies() {
            const container = document.getElementById('hotCompaniesList');

            if (hotCompaniesData.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-search text-3xl mb-4"></i>
                        <p>No hot companies detected yet.</p>
                        <p class="text-sm">Upload candidate data or sync with Google Sheets to detect hot companies.</p>
                    </div>
                `;
                return;
            }

            const hotCompaniesHtml = hotCompaniesData.map(company => `
                <tr class="hover:bg-gray-50">
                    <td class="px-6 py-4 whitespace-nowrap">
                        <div class="text-sm font-medium text-gray-900">${company.Company || company.company || 'Unknown'}</div>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${getEventTypeColor(company['Event Type'] || company.event_type || 'UNKNOWN')}">
                            ${company['Event Type'] || company.event_type || 'Unknown'}
                        </span>
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                        ${company.Industry || company.industry || 'Technology'}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${company.Source || company.source || 'Auto-detected'}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                        ${company.Date || company.date || new Date().toISOString().split('T')[0]}
                    </td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                        <button onclick="searchCandidatesFromCompany('${company.Company || company.company}')" 
                                class="text-blue-600 hover:text-blue-900 mr-2">
                            View Candidates
                        </button>
                        <div class="text-xs text-gray-500 mt-1" title="${company.Reason || company.reason || ''}">
                            ${company['Total Candidates'] || company.total_candidates || 0} total, 
                            ${company['Active Candidates'] || company.active_candidates || 0} active
                            ${company['Avg Score'] ? `, avg score: ${company['Avg Score']}` : ''}
                        </div>
                    </td>
                </tr>
            `).join('');

            container.innerHTML = `
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Company</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Event Type</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Industry</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Source</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            ${hotCompaniesHtml}
                        </tbody>
                    </table>
                </div>
            `;
        }

            const html = `
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Company</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Event Type</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Industry</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Source</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            ${hotCompaniesData.map(company => `
                                <tr class="hover:bg-gray-50">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm font-medium text-gray-900">${company['Company Name'] || ''}</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${getEventTypeColor(company['Event type'])}">
                                            ${company['Event type'] || ''}
                                        </span>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                        ${company['Industry'] || ''}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                        ${company['Source'] || ''}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                        ${company['Date Reported'] || ''}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <button onclick="searchCandidatesFromCompany('${company['Company Name']}')" class="text-blue-600 hover:text-blue-900">
                                            <i class="fas fa-search mr-1"></i>Find Candidates
                                        </button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            container.innerHTML = html;
        }

        function getEventTypeColor(eventType) {
            const colors = {
                'Layoffs': 'bg-red-100 text-red-800',
                'Closure': 'bg-red-100 text-red-800',
                'Executive Departures': 'bg-orange-100 text-orange-800',
                'Negative reviews': 'bg-yellow-100 text-yellow-800',
                'On the way down': 'bg-gray-100 text-gray-800'
            };
            return colors[eventType] || 'bg-gray-100 text-gray-800';
        }

        function generateDemoCandidates() {
            const candidates = [];
            const companies = ['Microsoft', 'Google', 'Wiz', 'Cybereason', 'Unity', 'Meta', 'Apple', 'Amazon'];
            const titles = ['Senior Backend Engineer', 'Frontend Developer', 'DevOps Engineer', 'Product Manager', 'Tech Lead'];
            const skills = ['Python', 'JavaScript', 'React', 'AWS', 'Kubernetes', 'Docker', 'Node.js', 'Java'];

            for (let i = 0; i < 100; i++) {
                candidates.push({
                    id: i + 1,
                    name: `Candidate ${i + 1}`,
                    company: companies[Math.floor(Math.random() * companies.length)],
                    title: titles[Math.floor(Math.random() * titles.length)],
                    skills: skills.slice(0, Math.floor(Math.random() * 4) + 2).join(', '),
                    experience: Math.floor(Math.random() * 10) + 1,
                    location: Math.random() > 0.5 ? 'Tel Aviv' : 'Remote',
                    status: Math.random() > 0.7 ? 'LOOKING' : 'OPEN',
                    score: Math.floor(Math.random() * 40) + 60,
                    linkedin: `https://linkedin.com/in/candidate${i + 1}`,
                    isHotCompany: hotCompaniesData.some(hc => hc['Company Name'] === companies[Math.floor(Math.random() * companies.length)])
                });
            }

            return candidates;
        }

        function performSearch() {
            const filters = {
                jobTitle: document.getElementById('jobTitle').value,
                skills: document.getElementById('skills').value,
                experience: document.getElementById('experience').value,
                location: document.getElementById('location').value,
                companyFilter: document.getElementById('companyFilter').value,
                scoreRange: parseInt(document.getElementById('scoreRange').value),
                onlyLooking: document.getElementById('onlyLooking').checked,
                onlyHotCompanies: document.getElementById('onlyHotCompanies').checked,
                onlyUnviewed: document.getElementById('onlyUnviewed').checked
            };

            let results = candidatesData.filter(candidate => {
                // Apply filters
                if (filters.jobTitle && !candidate.title.toLowerCase().includes(filters.jobTitle.toLowerCase())) {
                    return false;
                }
                if (filters.skills && !candidate.skills.toLowerCase().includes(filters.skills.toLowerCase())) {
                    return false;
                }
                if (filters.location && !candidate.location.toLowerCase().includes(filters.location.toLowerCase())) {
                    return false;
                }
                if (filters.companyFilter && !candidate.company.toLowerCase().includes(filters.companyFilter.toLowerCase())) {
                    return false;
                }
                if (candidate.score < filters.scoreRange) {
                    return false;
                }
                if (filters.onlyLooking && candidate.status !== 'LOOKING') {
                    return false;
                }
                if (filters.onlyHotCompanies && !candidate.isHotCompany) {
                    return false;
                }
                if (filters.onlyUnviewed && isViewed(candidate.id)) {
                    return false;
                }

                return true;
            });

            displaySearchResults(results);
            showNotification('success', 'Search Complete', `Found ${results.length} matching candidates`);
        }

        function displaySearchResults(results) {
            const container = document.getElementById('candidatesList');
            
            if (results.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-search text-4xl mb-4"></i>
                        <p>No candidates found matching your criteria</p>
                    </div>
                `;
                return;
            }

            const html = `
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Select</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Candidate</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Company</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Title</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Experience</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Score</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            ${results.map(candidate => `
                                <tr class="hover:bg-gray-50">
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <input type="checkbox" class="candidate-select rounded border-gray-300 text-blue-600 focus:ring-blue-500" data-candidate-id="${candidate.id}">
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        <div class="text-sm font-medium text-gray-900">${candidate.name}</div>
                                        <div class="text-sm text-gray-500">${candidate.skills}</div>
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap">
                                        ${candidate.status === 'LOOKING' ? 
                                            '<span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">🏷️ LOOKING</span>' :
                                            '<span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">OPEN</span>'
                                        }
                                        ${candidate.isHotCompany ? '<span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800 ml-1">🔥 HOT</span>' : ''}
                                    </td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${candidate.company}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${candidate.title}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${candidate.experience}y</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${candidate.score}</td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <a href="${candidate.linkedin}" target="_blank" class="text-blue-600 hover:text-blue-900 mr-4">
                                            <i class="fab fa-linkedin mr-1"></i>LinkedIn
                                        </a>
                                        <button onclick="markAsViewed(${candidate.id})" class="text-green-600 hover:text-green-900">
                                            <i class="fas fa-eye mr-1"></i>Mark Viewed
                                        </button>
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            container.innerHTML = html;

            // Add event listeners for checkboxes
            document.querySelectorAll('.candidate-select').forEach(checkbox => {
                checkbox.addEventListener('change', handleCandidateSelection);
            });
        }

        function handleCandidateSelection(e) {
            const candidateId = parseInt(e.target.dataset.candidateId);
            const candidate = candidatesData.find(c => c.id === candidateId);
            
            if (e.target.checked) {
                if (!selectedCandidates.find(c => c.id === candidateId)) {
                    selectedCandidates.push(candidate);
                }
            } else {
                selectedCandidates = selectedCandidates.filter(c => c.id !== candidateId);
            }
            
            updateSelectedCount();
            updateSelectedSidebar();
        }

        function updateSelectedCount() {
            document.getElementById('selectedCount').textContent = selectedCandidates.length;
        }

        function updateSelectedSidebar() {
            const container = document.getElementById('selectedCandidatesList');
            
            if (selectedCandidates.length === 0) {
                container.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        <i class="fas fa-users text-4xl mb-4"></i>
                        <p>No candidates selected</p>
                    </div>
                `;
                return;
            }

            const html = selectedCandidates.map(candidate => `
                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="flex justify-between items-start">
                        <div>
                            <h4 class="font-semibold text-gray-900">${candidate.name}</h4>
                            <p class="text-sm text-gray-600">${candidate.company} • ${candidate.title}</p>
                            <p class="text-xs text-gray-500">${candidate.skills}</p>
                        </div>
                        <button onclick="removeFromSelected(${candidate.id})" class="text-gray-400 hover:text-red-500">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }

        function removeFromSelected(candidateId) {
            selectedCandidates = selectedCandidates.filter(c => c.id !== candidateId);
            updateSelectedCount();
            updateSelectedSidebar();
            
            // Update checkbox in main list
            const checkbox = document.querySelector(`[data-candidate-id="${candidateId}"]`);
            if (checkbox) checkbox.checked = false;
        }

        function toggleSidebar() {
            const sidebar = document.getElementById('selectedSidebar');
            sidebar.classList.toggle('translate-x-full');
        }

        function closeSidebar() {
            const sidebar = document.getElementById('selectedSidebar');
            sidebar.classList.add('translate-x-full');
        }

        function clearSelectedCandidates() {
            selectedCandidates = [];
            updateSelectedCount();
            updateSelectedSidebar();
            
            // Clear all checkboxes
            document.querySelectorAll('.candidate-select').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            showNotification('success', 'Selection Cleared', 'All candidates removed from selection');
        }

        function exportSelectedCandidates() {
            if (selectedCandidates.length === 0) {
                showNotification('warning', 'No Selection', 'Please select candidates first');
                return;
            }

            const csvContent = generateCSV(selectedCandidates);
            downloadCSV(csvContent, 'selected_candidates.csv');
            showNotification('success', 'Export Complete', `${selectedCandidates.length} candidates exported`);
        }

        function exportLinkedInUrls() {
            if (selectedCandidates.length === 0) {
                showNotification('warning', 'No Selection', 'Please select candidates first');
                return;
            }

            const urls = selectedCandidates.map(c => c.linkedin).join('\n');
            copyToClipboard(urls);
            showNotification('success', 'URLs Copied', 'LinkedIn URLs copied to clipboard');
        }

        function generateCSV(data) {
            const headers = ['Name', 'Company', 'Title', 'Skills', 'Experience', 'Location', 'Status', 'Score', 'LinkedIn'];
            const rows = data.map(candidate => [
                candidate.name,
                candidate.company,
                candidate.title,
                candidate.skills,
                candidate.experience,
                candidate.location,
                candidate.status,
                candidate.score,
                candidate.linkedin
            ]);

            return [headers, ...rows].map(row => 
                row.map(field => `"${field}"`).join(',')
            ).join('\n');
        }

        function downloadCSV(content, filename) {
            const blob = new Blob([content], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function generateLinkedInQuery() {
            return '("Backend Engineer" OR "Senior Developer") ("Python" OR "AWS" OR "Kubernetes") ("Wiz" OR "Cybereason" OR "Astrix")';
        }

        function generateGoogleQuery() {
            return '("Backend Engineer" OR "Senior Developer") Python AWS site:linkedin.com';
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showNotification('success', 'Copied!', 'Text copied to clipboard');
            });
        }

        function openLinkedInSearch(query) {
            const url = `https://www.linkedin.com/search/people/?keywords=${encodeURIComponent(query)}`;
            window.open(url, '_blank');
        }

        function openGoogleSearch(query) {
            const url = `https://www.google.com/search?q=${encodeURIComponent(query)}`;
            window.open(url, '_blank');
        }

        function searchCandidatesFromCompany(companyName) {
            switchTab('search');
            document.getElementById('companyFilter').value = companyName;
            performSearch();
        }

        function isViewed(candidateId) {
            if (!currentUser) return false;
            const userViewed = viewedCandidates[currentUser] || [];
            return userViewed.includes(candidateId);
        }

        function markAsViewed(candidateId) {
            if (!currentUser) {
                showNotification('warning', 'Login Required', 'Please select your user to track viewed candidates');
                return;
            }

            if (!viewedCandidates[currentUser]) {
                viewedCandidates[currentUser] = [];
            }

            if (!viewedCandidates[currentUser].includes(candidateId)) {
                viewedCandidates[currentUser].push(candidateId);
                localStorage.setItem('viewedCandidates', JSON.stringify(viewedCandidates));
                showNotification('success', 'Marked as Viewed', 'Candidate marked as viewed');
            }
        }

        function updateUserStatus() {
            const userInfo = document.querySelector('.user-info');
            if (currentUser) {
                // Show user-specific UI
            } else {
                // Show guest UI
            }
        }

        function updateDashboardStats() {
            // Update stats based on loaded data
            document.getElementById('topProfilesCount').textContent = scorelyData.filter(c => c.category === 'TOP').length;
            document.getElementById('goodProfilesCount').textContent = scorelyData.filter(c => c.category === 'GOOD').length;
        }

        async function testGoogleConnection() {
            const apiKey = document.getElementById('googleApiKey').value;
            const statusEl = document.getElementById('googleConnectionStatus');
            
            if (!apiKey) {
                statusEl.innerHTML = '<div class="text-red-600"><i class="fas fa-times-circle mr-2"></i>Please enter API key</div>';
                return;
            }

            statusEl.innerHTML = '<div class="text-blue-600"><i class="fas fa-spinner fa-spin mr-2"></i>Testing connection...</div>';

            try {
                const testUrl = `https://sheets.googleapis.com/v4/spreadsheets/${SHEETS_CONFIG.hotCompanies.sheetId}?key=${apiKey}`;
                const response = await fetch(testUrl);
                
                if (response.ok) {
                    statusEl.innerHTML = '<div class="text-green-600"><i class="fas fa-check-circle mr-2"></i>Connection successful!</div>';
                    localStorage.setItem('googleApiKey', apiKey);
                    showNotification('success', 'Google Sheets Connected', 'API connection verified');
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                statusEl.innerHTML = '<div class="text-red-600"><i class="fas fa-times-circle mr-2"></i>Connection failed: ' + error.message + '</div>';
                showNotification('error', 'Connection Failed', 'Check your API key and try again');
            }
        }

        async function testOpenAIConnection() {
            const apiKey = document.getElementById('openaiApiKey').value;
            const statusEl = document.getElementById('openaiConnectionStatus');
            
            if (!apiKey) {
                statusEl.innerHTML = '<div class="text-red-600"><i class="fas fa-times-circle mr-2"></i>Please enter API key</div>';
                return;
            }

            statusEl.innerHTML = '<div class="text-blue-600"><i class="fas fa-spinner fa-spin mr-2"></i>Testing connection...</div>';

            try {
                const response = await fetch('https://api.openai.com/v1/models', {
                    headers: {
                        'Authorization': `Bearer ${apiKey}`
                    }
                });
                
                if (response.ok) {
                    statusEl.innerHTML = '<div class="text-green-600"><i class="fas fa-check-circle mr-2"></i>Connection successful!</div>';
                    localStorage.setItem('openaiApiKey', apiKey);
                    showNotification('success', 'OpenAI Connected', 'API connection verified');
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                statusEl.innerHTML = '<div class="text-red-600"><i class="fas fa-times-circle mr-2"></i>Connection failed: ' + error.message + '</div>';
                showNotification('error', 'Connection Failed', 'Check your API key and try again');
            }
        }

        function handleFileUpload(e) {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(event) {
                try {
                    const data = JSON.parse(event.target.result);
                    scorelyData = data;
                    document.getElementById('uploadStatus').classList.remove('hidden');
                    updateDashboardStats();
                    showNotification('success', 'File Uploaded', `${data.length} candidate profiles loaded`);
                } catch (error) {
                    showNotification('error', 'Upload Failed', 'Invalid JSON file format');
                }
            };
            reader.readAsText(file);
        }

        async function findSimilarCandidates() {
            const input = document.getElementById('similarityInput').value;
            if (!input.trim()) {
                showNotification('warning', 'Input Required', 'Please enter a job description or candidate profile');
                return;
            }

            if (scorelyData.length === 0) {
                showNotification('warning', 'No Data', 'Please upload Scorely results first');
                return;
            }

            const apiKey = OPENAI_API_KEY || document.getElementById('openaiApiKey').value;
            if (!apiKey) {
                showNotification('error', 'API Key Missing', 'Please configure OpenAI API key in settings');
                return;
            }

            // Show loading state
            document.getElementById('findSimilarBtn').innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Finding Similar Candidates...';
            
            try {
                // Generate embedding for input
                const embedding = await generateEmbedding(input, apiKey);
                
                // Calculate similarities
                const similarities = scorelyData.map(candidate => ({
                    ...candidate,
                    similarity: calculateCosineSimilarity(embedding, candidate.embedding)
                })).sort((a, b) => b.similarity - a.similarity);

                displaySimilarityResults(similarities.slice(0, 10));
                showNotification('success', 'Analysis Complete', `Found ${similarities.length} similar candidates`);
            } catch (error) {
                showNotification('error', 'Analysis Failed', error.message);
            } finally {
                document.getElementById('findSimilarBtn').innerHTML = '<i class="fas fa-magic mr-2"></i>Find Similar Candidates';
            }
        }

        async function generateEmbedding(text, apiKey) {
            const response = await fetch('https://api.openai.com/v1/embeddings', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${apiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    input: text,
                    model: document.getElementById('openaiModel').value || 'text-embedding-3-small'
                })
            });

            if (!response.ok) {
                throw new Error(`OpenAI API error: ${response.status}`);
            }

            const data = await response.json();
            return data.data[0].embedding;
        }

        function calculateCosineSimilarity(a, b) {
            if (!a || !b || a.length !== b.length) return 0;
            
            let dotProduct = 0;
            let normA = 0;
            let normB = 0;
            
            for (let i = 0; i < a.length; i++) {
                dotProduct += a[i] * b[i];
                normA += a[i] * a[i];
                normB += b[i] * b[i];
            }
            
            return dotProduct / (Math.sqrt(normA) * Math.sqrt(normB));
        }

        function displaySimilarityResults(results) {
            const container = document.getElementById('similarityResults');
            const listContainer = document.getElementById('similarityList');
            
            const html = results.map(candidate => `
                <div class="bg-gray-50 rounded-lg p-4 mb-4">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h4 class="font-semibold text-gray-900">${candidate.name}</h4>
                            <p class="text-sm text-gray-600">${candidate.company} • ${candidate.category}</p>
                        </div>
                        <div class="text-right">
                            <div class="text-lg font-bold text-blue-600">${Math.round(candidate.similarity * 100)}%</div>
                            <div class="text-xs text-gray-500">Match</div>
                        </div>
                    </div>
                    <div class="progress-bar mb-3">
                        <div class="progress-fill" style="width: ${candidate.similarity * 100}%"></div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <span class="text-gray-500">Score:</span>
                            <span class="font-medium">${candidate.score}</span>
                        </div>
                        <div>
                            <span class="text-gray-500">Experience:</span>
                            <span class="font-medium">${candidate.experience}</span>
                        </div>
                    </div>
                </div>
            `).join('');
            
            listContainer.innerHTML = html;
            container.classList.remove('hidden');
        }

        function showNotification(type, title, message) {
            const notification = document.getElementById('notification');
            const icon = document.getElementById('notificationIcon');
            const titleEl = document.getElementById('notificationTitle');
            const messageEl = document.getElementById('notificationMessage');

            const icons = {
                success: '<i class="fas fa-check-circle text-green-500"></i>',
                error: '<i class="fas fa-times-circle text-red-500"></i>',
                warning: '<i class="fas fa-exclamation-triangle text-yellow-500"></i>',
                info: '<i class="fas fa-info-circle text-blue-500"></i>'
            };

            icon.innerHTML = icons[type] || icons.info;
            titleEl.textContent = title;
            messageEl.textContent = message;

            notification.classList.add('show');

            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }
    </script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDjRfulDrBk1TUb77%2FXH87KtSawM%2F%2F%2FwKhhKTRIRgS5vNHnz6LJQDYCGI%2BNIHZFeV7riTRc7%2FjoKhdsAFOn8uu38432UrbtVynwTLA1e7fRnf%2FhN6MHM7a%2BaaogFJARCoFeG350G44lyRmMThdOgnk80gKciM%2FVrTPg%2FiBOki4CHe0fplSAOJ1HcNXEn2hvioonop6%2F7gLmoTdbOZIPGdV8zDKZNoIjtvmL9f4Dh0Kpu0ln8MCtt5OAacacUqcJMhS2G7t9ekmBX6GVcnHhCADGY5JlXl6THK5GG%2FlGPBmZDX8UaKjHVJFZGfhPST%2B3ALtri31QBVzkLwxSHBPNW%2Bbglo4DCKrU%2BrmdB2YnGKNPlwJ2492vpSOnY5OeirGsmtEPMxyMycsNCCk815ADia6L3nEKR0aIx%2BPF3a%2BvpfLcqEnwTDZrOL9ckCVwFbiwOKpTxRGPdxVgACvzAPUlU5TdMv%2B3ISJsRv6osRk1nDjYHYAxayjpPdw89umgEUtwmpYQ%3D%3D";
        window.__genspark_locale = "en-US";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDjRfulDrBk1TUb77/XH87KtSawM///wKhhKTRIRgS5vNHnz6LJQDYCGI+NIHZFeV7riTRc7/joKhdsAFOn8uu38432UrbtVynwTLA1e7fRnf/hN6MHM7a+aaogFJARCoFeG350G44lyRmMThdOgnk80gKciM/VrTPg/iBOki4CHe0fplSAOJ1HcNXEn2hvioonop6/7gLmoTdbOZIPGdV8zDKZNoIjtvmL9f4Dh0Kpu0ln8MCtt5OAacacUqcJMhS2G7t9ekmBX6GVcnHhCADGY5JlXl6THK5GG/lGPBmZDX8UaKjHVJFZGfhPST+3ALtri31QBVzkLwxSHBPNW+bglo4DCKrU+rmdB2YnGKNPlwJ2492vpSOnY5OeirGsmtEPMxyMycsNCCk815ADia6L3nEKR0aIx+PF3a+vpfLcqEnwTDZrOL9ckCVwFbiwOKpTxRGPdxVgACvzAPUlU5TdMv+3ISJsRv6osRk1nDjYHYAxayjpPdw89umgEUtwmpYQ==";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
